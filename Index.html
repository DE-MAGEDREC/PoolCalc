<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PoolCalc â€” Concepteur Piscine</title>
<style>
:root{--bg:#e0f7fa;--card:#ffffff;--primary:#00bcd4;--muted:#006064}
*{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
body{margin:0;background:linear-gradient(180deg,#b2ebf2 0%,var(--bg) 100%);color:#004d40}
.container{max-width:1100px;margin:28px auto;padding:20px}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px}
.title{font-size:20px;font-weight:700}
.langs button{margin-left:6px;padding:6px 8px;border-radius:6px;border:1px solid #e0f2f1;background:white;cursor:pointer}
.card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(8,15,28,0.06);margin-top:12px}
.tabs{display:flex;gap:8px;flex-wrap:wrap}
.tab{padding:8px 10px;border-radius:8px;background:#e0f2f1;border:1px solid #b2ebf2;cursor:pointer}
.tab.active{background:var(--primary);color:white}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.row{display:flex;gap:8px;align-items:center;margin-bottom:8px}
input[type=number],select,input[type=text]{padding:8px;border:1px solid #dfe8ee;border-radius:8px;width:100%}
.table{width:100%;border-collapse:collapse;margin-top:8px}
.table th,.table td{padding:8px;border-bottom:1px solid #eef2f7;text-align:left;font-size:13px}
.small{font-size:13px;color:var(--muted)}
.footer{margin-top:16px;font-size:13px;color:var(--muted)}
.btn{padding:8px 12px;border-radius:8px;background:var(--primary);color:white;border:none;cursor:pointer}
.flex{display:flex;gap:8px;align-items:center}
.checkbox{display:flex;gap:6px;align-items:center}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="title">PoolCalc</div>
    <div class="flex">
      <div class="small" id="greeting">FranÃ§ais</div>
      <div class="langs">
        <button data-lang="fr">ðŸ‡«ðŸ‡· FR</button>
        <button data-lang="en">ðŸ‡¬ðŸ‡§ EN</button>
        <button data-lang="es">ðŸ‡ªðŸ‡¸ ES</button>
      </div>
    </div>
  </div>
  <div class="card">
    <div class="tabs" id="tabs"></div>
    <div id="content" class="mt-4"></div>
  </div>
  <div class="footer small">Prototype â€” adapte les coefficients selon tes normes locales avant validation.</div>
</div>

<script>
// === Multilingual strings ===
const STR = {
  fr: {tabs:['ParamÃ¨tres','Tuyauteries','Filtration','Hydraulique','RÃ©sumÃ©'],
       piscine_neuve:'Piscine neuve', renovation:'RÃ©novation / remplacement', forme:'Forme',
       rect:'Rectangulaire', lshape:'En L', circle:'Circulaire',
       L:'L (m)', l:'l (m)', h:'h (m)', turnover:'Temps de renouvellement (h)',
       pieces:'PiÃ¨ces Ã  sceller', ajouter_troncon:'Ajouter tronÃ§on',
       debit_pompe:'DÃ©bit pompe (mÂ³/h) â€” laisser 0 pour calcul automatique',
       volume:'Volume piscine', debit_cible:'DÃ©bit cible', surface_filtre:'Surface filtre recommandÃ©e (mÂ²)',
       diam_filtre:'DiamÃ¨tre filtre (m)', v_asp:"Vitesse aspiration (m/s)", v_ref:"Vitesse refoulement (m/s)",
       materiau:'MatÃ©riau tuyau', pertes_troncons:'Pertes par tronÃ§on',
       telecharger:'TÃ©lÃ©charger le rÃ©sumÃ© (JSON)', calculer:'Calculer'},
  en: {tabs:['Parameters','Pipes','Filtration','Hydraulics','Summary'],
       piscine_neuve:'New pool', renovation:'Renovation / replacement', forme:'Shape',
       rect:'Rectangular', lshape:'L-shaped', circle:'Circular',
       L:'L (m)', l:'w (m)', h:'d (m)', turnover:'Turnover time (h)',
       pieces:'Embedded fittings', ajouter_troncon:'Add run',
       debit_pompe:'Pump flow (mÂ³/h) â€” leave 0 to auto-calc',
       volume:'Pool volume', debit_cible:'Target flow', surface_filtre:'Recommended filter area (mÂ²)',
       diam_filtre:'Filter diameter (m)', v_asp:"Suction velocity (m/s)", v_ref:"Return velocity (m/s)",
       materiau:'Pipe material', pertes_troncons:'Losses per run',
       telecharger:'Download summary (JSON)', calculer:'Calculate'},
  es: {tabs:['ParÃ¡metros','TuberÃ­as','FiltraciÃ³n','HidrÃ¡ulica','Resumen'],
       piscine_neuve:'Piscina nueva', renovation:'RenovaciÃ³n / reemplazo', forme:'Forma',
       rect:'Rectangular', lshape:'En L', circle:'Circular',
       L:'L (m)', l:'a (m)', h:'h (m)', turnover:'Tiempo de renovaciÃ³n (h)',
       pieces:'Elementos empotrados', ajouter_troncon:'Agregar tramo',
       debit_pompe:'Caudal bomba (mÂ³/h) â€” dejar 0 para calcular',
       volume:'Volumen piscina', debit_cible:'Caudal objetivo', surface_filtre:'Superficie filtro recomendada (mÂ²)',
       diam_filtre:'DiÃ¡metro filtro (m)', v_asp:"Velocidad aspiraciÃ³n (m/s)", v_ref:"Velocidad impulsiÃ³n (m/s)",
       materiau:'Material tuberÃ­a', pertes_troncons:'PÃ©rdidas por tramo',
       telecharger:'Descargar resumen (JSON)', calculer:'Calcular'}
};

// === Default model ===
let LANG='fr';
let model={isNew:true,shape:'RECT',rect:{L:10,l:4,h:1.5},lshape:{L1:6,l1:4,L2:4,l2:3,h:1.5},
turnover:6,fittings:{skimmer:true,bonde:true,refoulement:true,vanne:false,coude90:false,coude45:false,arrivee:false},
pipeRuns:[{name:'TronÃ§on 1',length:15,diameter:0.05}],pumpFlow:0,vAsp:1,vRef:1,pipeMaterial:'PVC'};

// === Pipe material roughness & fittings ===
const ROUGH={PVC:1.5e-6,PE:1.5e-6,ACIER:4.6e-5,CUIVRE:1.5e-6};
const FITTINGS=[{key:'skimmer',label:{fr:'Skimmer',en:'Skimmer',es:'Skimmer'},K:0.5},
{key:'bonde',label:{fr:'Bonde de fond',en:'Main drain',es:'DesagÃ¼e'},K:1.0},
{key:'refoulement',label:{fr:'Refoulement',en:'Return',es:'ImpulsiÃ³n'},K:0.2},
{key:'vanne',label:{fr:'Vanne',en:'Valve',es:'VÃ¡lvula'},K:4.0},
{key:'coude90',label:{fr:'Coude 90Â°',en:'Elbow 90Â°',es:'Codo 90Â°'},K:0.9},
{key:'coude45',label:{fr:'Coude 45Â°',en:'Elbow 45Â°',es:'Codo 45Â°'},K:0.4},
{key:'arrivee',label:{fr:'ArrivÃ©e projecteur',en:'Light inlet',es:'Toma de luz'},K:2.0}];

// === Simple functions ===
const G=9.81, NU=1e-6;
function m3h_to_m3s(q){return q/3600;}
function diameterFromQandV(Q,V){return Math.sqrt((4*Q)/(Math.PI*V));}
function swameeJain(eps,D,Re){if(Re<=0) return 0.03; const A=eps/(3.7*D); const B=5.74/Math.pow(Re,0.9); return 0.25/Math.pow(Math.log10(A+B),2);}
function headLossDarcy(Q,D,L,K,eps){if(D<=0||L<=0) return {hf_total:0,V:0,Re:0,f:0,hf_friction:0,hf_singular:0};
const A=Math.PI*D*D/4; const V=Q/A; const Re=Math.abs(V)*D/NU; const f=swameeJain(eps,D,Re);
const hf_friction=f*(L/D)*(V*V/(2*G)); const hf_singular=K*(V*V/(2*G)); return {hf_total:hf_friction+hf_singular,V,Re,f,hf_friction,hf_singular};}

// === DOM elements ===
const tabsEl=document.getElementById('tabs'), contentEl=document.getElementById('content'), greeting=document.getElementById('greeting');
function setLang(l){LANG=l; greeting.textContent=(l==='fr'?'FranÃ§ais':(l==='en'?'English':'EspaÃ±ol')); renderTabs(); renderContent(1);}
document.querySelectorAll('.langs button').forEach(b=>b.addEventListener('click',()=>setLang(b.dataset.lang)));

// === Render tabs ===
function renderTabs(){tabsEl.innerHTML='';STR[LANG].tabs.forEach((t,i)=>{const btn=document.createElement('div');btn.textContent=t;btn.className='tab';btn.onclick=()=>renderContent(i+1);tabsEl.appendChild(btn);});}

// === Render content per tab ===
function renderContent(tab){Array.from(tabsEl.children).forEach((b,i)=>b.classList.toggle('active',i===tab-1));contentEl.innerHTML='';
if(tab===1){renderTab1();}
else if(tab===2){renderTab2();}
else if(tab===3){renderTab3();}
else if(tab===4){renderTab4();}
else if(tab===5){renderTab5();}
}

// --- Tab 1: paramÃ¨tres gÃ©nÃ©raux ---
function renderTab1(){
const s=STR[LANG];
contentEl.innerHTML=`
<div class="row">
<label><input type="radio" name="newPool" ${model.isNew?'checked':''}> ${s.piscine_neuve}</label>
<label><input type="radio" name="newPool" ${!model.isNew?'checked':''}> ${s.renovation}</label>
</div>
<div class="row"><label>${s.forme}</label>
<select id="shape">
<option value="RECT" ${model.shape==='RECT'?'selected':''}>${s.rect}</option>
<option value="L" ${model.shape==='L'?'selected':''}>${s.lshape}</option>
<option value="CIRCLE" ${model.shape==='CIRCLE'?'selected':''}>${s.circle}</option>
</select></div>
<div class="grid">
<div class="row"><label>${s.L}</label><input type="number" id="dimL" value="${model.rect.L}"></div>
<div class="row"><label>${s.l}</label><input type="number" id="diml" value="${model.rect.l}"></div>
<div class="row"><label>${s.h}</label><input type="number" id="dimh" value="${model.rect.h}"></div>
</div>
<button class="btn" onclick="renderContent(2)">${s.calculer}</button>`;
}

// --- Tab 2: Tuyauteries ---
function renderTab2(){const s=STR[LANG]; contentEl.innerHTML=`<div class="row"><label>${s.pieces}</label></div>`;}

// --- Tab 3: Filtration ---
function renderTab3(){const s=STR[LANG]; contentEl.innerHTML=`<div class="row"><label>${s.debit_pompe}</label><input type="number"></div>`;}

// --- Tab 4: Hydraulique ---
function renderTab4(){const s=STR[LANG]; contentEl.innerHTML=`<div class="row"><label>${s.v_asp}</label><input type="number"></div>
<div class="row"><label>${s.v_ref}</label><input type="number"></div>`;}

// --- Tab 5: RÃ©sumÃ© ---
function renderTab5(){const s=STR[LANG];contentEl.innerHTML=`<button class="btn" onclick="downloadJSON()">${s.telecharger}</button>`;}

// --- Download JSON ---
function downloadJSON(){const data=JSON.stringify(model,null,2);const blob=new Blob([data],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='poolcalc_summary.json';a.click();URL.revokeObjectURL(url);}

// --- Init ---
renderTabs();
renderContent(1);
</script>
</body>
</html>
